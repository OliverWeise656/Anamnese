<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprachverständnis-Test</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            box-sizing: border-box;
        }
        #chatbot, #tone-setting, #initial-test, #test, #hearing-test {
            background: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            padding: 20px;
        }
        h1 {
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        p {
            font-size: 1em;
            line-height: 1.4;
            margin-bottom: 20px;
        }
        .hidden {
            display: none;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
        }
        .user {
            background-color: #d1e7dd;
            text-align: right;
        }
        .doktor {
            background-color: #f8d7da;
            text-align: left;
        }
        .test-area {
            display: none;
        }
        input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        button {
            padding: 10px 20px;
            margin: 10px 0;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: #fff;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f8f9fa;
        }
        canvas {
            margin-top: 20px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image-more/2.9.0/dom-to-image-more.min.js"></script>
</head>
<body>
    <div id="chatbot">
        <h1>Zunächst möchten wir Sie bitte, uns ein paar Fragen kurz, stichwortartig zu beantworten. Handelt es sich bei dem Patienten um ein Kind, das jünger als 4 Jahre ist, brauchen Sie die Fragen und Tests nicht durchführen. Bitte geben Sie zunächst das Alter des Patienten ein:</h1>
        <div id="messages"></div>
        <input type="text" id="userInput" placeholder="Ihre Nachricht...">
        <button onclick="sendMessage()">Senden</button>
    </div>

    <div id="tone-setting" class="hidden">
        <h1>Ton-Einstellung</h1>
        <p>Für die folgenden Tests ist es notwendig Ihren Ton einzustellen. Begeben Sie sich hierzu in eine ruhige Umgebung. Nutzen Sie am besten einen Kopfhörer. Wenn Sie den Test mit Ihrem Kind zusammen machen, dann können Sie auch den Lautsprecher Ihres Rechners benutzen, um zu hören, was Ihr Kind nachsprechen soll:</p>
        <p>Nach dem Drücken von "Start" hören Sie einen Ton, stellen Sie die Lautstärke Ihres Kopfhörers oder Lautsprechers so ein, dass sie den Ton gerade noch hören können. Wenn Sie fertig sind drücken Sie "Stopp".</p>
        <button id="startButton">Start</button>
        <button id="stopButton" disabled>Stopp</button>
    </div>

    <div id="initial-test" class="hidden">
        <h1 id="initial-test-heading">Sprachverständnis-Test - tragen Sie das gehörte Wort in das vorgesehene Feld ein.</h1>
        <p id="initial-instructions">Drücke den Button, um den Test zu starten.</p>
        <button id="start-initial-test-button">Test starten</button>
        <div id="test-area">
            <p id="audio-instruction"></p>
            <input type="text" id="answer-input">
            <button id="submit-initial-test-button">Bestätigen</button>
        </div>
        <p id="initial-test-result" class="hidden"></p>
    </div>

    <div id="test" class="hidden">
        <h1>Sprachverständnis im Störschall</h1>
        <audio id="audioPlayer"></audio>
        <input type="text" id="response" placeholder="Ihre Antwort...">
        <button id="nextButton">Nächstes Wort</button>
    </div>

    <div id="hearing-test" class="hidden">
        <h1>Hörtest</h1>
        <div id="instructions">
            <p>Sie werden auf jeder Seite 6 Töne hören. Zuerst wird das rechte Ohr getestet. Drücken Sie den Knopf, wenn Sie den Ton hören.</p>
            <button onclick="startTest('right')">Rechtes Ohr Testen</button>
        </div>
        <div id="right-test-done" class="hidden">
            <p>Der Test des rechten Ohres ist abgeschlossen. Jetzt das linke Ohr testen.</p>
            <button onclick="startTest('left')">Linkes Ohr Testen</button>
        </div>
        <div id="test-area">
            <button onclick="heardTone()">Ton gehört</button>
        </div>
        <div id="results" class="hidden">
            <h2>Ergebnisse</h2>
            <table>
                <thead>
                    <tr>
                        <th>Frequenz (Hz)</th>
                        <th>Rechts (dB)</th>
                        <th>Links (dB)</th>
                    </tr>
                </thead>
                <tbody id="resultsTableBody"></tbody>
            </table>
            <canvas id="resultsChart" width="400" height="200"></canvas>
        </div>
    </div>

    <div id="final-result" class="hidden"></div>
    <div id="thank-you" class="hidden">
        <h1>Herzlichen Dank für Ihre Mitarbeit.</h1>
        <p>Auf dem Desktop wurden ihre Ergebnisse abgelegt. Bitte leiten sie diese an uns weiter!</p>
    </div>

    <script src="script.js"></script>
</body>
</html>
